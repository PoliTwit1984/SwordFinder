<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwordFinder API - Baseball Statcast Analysis</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container py-5">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <!-- Header -->
                <div class="text-center mb-5">
                    <i class="fas fa-baseball-ball fa-3x text-primary mb-3"></i>
                    <h1 class="display-4 fw-bold">SwordFinder API</h1>
                    <p class="lead text-muted">Analyze baseball Statcast data to identify and score "sword swings"</p>
                </div>

                <!-- API Documentation -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="card-title mb-0"><i class="fas fa-book me-2"></i>API Documentation</h3>
                    </div>
                    <div class="card-body">
                        <h5>Endpoint</h5>
                        <div class="code-block mb-3">
                            <code>POST /swords</code>
                        </div>

                        <h5>Request Format</h5>
                        <pre class="code-block"><code>{
  "date": "YYYY-MM-DD"
}</code></pre>

                        <h5>Sword Swing Criteria</h5>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-success me-2"></i>Swing outcome: swinging_strike or swinging_strike_blocked</li>
                            <li><i class="fas fa-check text-success me-2"></i>Bat speed < 60 mph</li>
                            <li><i class="fas fa-check text-success me-2"></i>Intercept Y > 14 inches</li>
                            <li><i class="fas fa-check text-success me-2"></i>Swing path tilt > 30 degrees</li>
                        </ul>

                        <h5>Scoring Formula</h5>
                        <div class="code-block mb-3">
                            <code>sword_score = 0.35×(60-bat_speed)/60 + 0.25×swing_tilt/60 + 0.25×intercept_y/50 + 0.15×zone_penalty</code>
                        </div>
                        <p class="small text-muted">Normalized to 50-100 scale, returns top 5 swings</p>
                    </div>
                </div>

                <!-- API Tester -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="card-title mb-0"><i class="fas fa-flask me-2"></i>API Tester</h3>
                    </div>
                    <div class="card-body">
                        <form id="apiForm">
                            <div class="mb-3">
                                <label for="dateInput" class="form-label">Date (YYYY-MM-DD)</label>
                                <input type="date" class="form-control" id="dateInput" required>
                                <div class="form-text">Select a date to analyze sword swings</div>
                            </div>
                            <button type="submit" class="btn btn-primary" id="analyzeBtn">
                                <i class="fas fa-search me-2"></i>Analyze Sword Swings
                            </button>
                        </form>

                        <!-- Loading Spinner -->
                        <div id="loadingSpinner" class="text-center mt-4" style="display: none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 text-muted">Analyzing Statcast data...</p>
                        </div>

                        <!-- Results -->
                        <div id="results" class="mt-4" style="display: none;">
                            <h5>Results</h5>
                            <div id="resultsContent"></div>
                        </div>

                        <!-- Raw JSON Button (shows after results) -->
                        <div id="rawJsonButtonContainer" class="mt-3" style="display: none;">
                            <button type="button" class="btn btn-outline-secondary" id="viewRawJsonBtn" onclick="showRawJsonModal()">
                                <i class="fas fa-code me-2"></i>View Raw JSON
                            </button>
                        </div>

                        <!-- Error Display -->
                        <div id="errorAlert" class="alert alert-danger mt-4" style="display: none;">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <span id="errorMessage"></span>
                        </div>
                    </div>
                </div>

                <!-- Example Response -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title mb-0"><i class="fas fa-code me-2"></i>Example Response</h3>
                    </div>
                    <div class="card-body">
                        <pre class="code-block"><code>{
  "success": true,
  "count": 5,
  "date": "2025-05-24",
  "data": [
    {
      "player_name": "Herrin, Tim",
      "pitch_type": "CU",
      "bat_speed": 34.4,
      "intercept_y": 30.1,
      "swing_path_tilt": 46.1,
      "sword_score": 100.0,
      "play_id": "",
      "game_pk": 777796,
      "inning": 9,
      "pitch_number": 5
    },
    {
      "player_name": "Peterson, David",
      "pitch_type": "CU",
      "bat_speed": 39.8,
      "intercept_y": 39.4,
      "swing_path_tilt": 41.3,
      "sword_score": 99.2,
      "play_id": "",
      "game_pk": 777789,
      "inning": 3,
      "pitch_number": 2
    },
    {
      "player_name": "Helsley, Ryan",
      "pitch_type": "SL",
      "bat_speed": 43.5,
      "intercept_y": 39.9,
      "swing_path_tilt": 43.8,
      "sword_score": 97.6,
      "play_id": "",
      "game_pk": 777786,
      "inning": 9,
      "pitch_number": 5
    },
    {
      "player_name": "Valdez, Framber",
      "pitch_type": "CU",
      "bat_speed": 29.9,
      "intercept_y": 34.1,
      "swing_path_tilt": 31.3,
      "sword_score": 97.3,
      "play_id": "",
      "game_pk": 777787,
      "inning": 3,
      "pitch_number": 3
    },
    {
      "player_name": "Matthews, Zebby",
      "pitch_type": "SL",
      "bat_speed": 26.2,
      "intercept_y": 19.0,
      "swing_path_tilt": 44.0,
      "sword_score": 97.2,
      "play_id": "",
      "game_pk": 777788,
      "inning": 2,
      "pitch_number": 4
    }
  ]
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Raw JSON Modal -->
    <div class="modal fade" id="rawJsonModal" tabindex="-1" aria-labelledby="rawJsonModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="rawJsonModalLabel">
                        <i class="fas fa-code me-2"></i>Raw JSON Response
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-end mb-2">
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="copyJsonToClipboard()">
                            <i class="fas fa-copy me-1"></i>Copy
                        </button>
                    </div>
                    <pre class="code-block" style="max-height: 400px; overflow-y: auto;"><code id="rawJsonContent"></code></pre>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('apiForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const dateInput = document.getElementById('dateInput');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const results = document.getElementById('results');
            const resultsContent = document.getElementById('resultsContent');
            const errorAlert = document.getElementById('errorAlert');
            
            // Reset UI
            loadingSpinner.style.display = 'block';
            results.style.display = 'none';
            errorAlert.style.display = 'none';
            analyzeBtn.disabled = true;
            
            try {
                const response = await fetch('/swords', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        date: dateInput.value
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayResults(data);
                    updateExampleResponse(data);
                } else {
                    showError(data.error || 'Unknown error occurred');
                }
                
            } catch (error) {
                showError('Network error: ' + error.message);
            } finally {
                loadingSpinner.style.display = 'none';
                analyzeBtn.disabled = false;
            }
        });
        
        function displayResults(data) {
            const resultsContent = document.getElementById('resultsContent');
            const results = document.getElementById('results');
            
            if (data.data.length === 0) {
                resultsContent.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No sword swings found for ${data.date}
                    </div>
                `;
            } else {
                let html = `
                    <div class="alert alert-success">
                        <i class="fas fa-trophy me-2"></i>
                        Found ${data.count} sword swing${data.count > 1 ? 's' : ''} for ${data.date}
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>Pitch Type</th>
                                    <th>Bat Speed</th>
                                    <th>Intercept Y</th>
                                    <th>Swing Tilt</th>
                                    <th>Sword Score</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                data.data.forEach(swing => {
                    html += `
                        <tr>
                            <td><strong>${swing.player_name}</strong></td>
                            <td><span class="badge bg-secondary">${swing.pitch_type}</span></td>
                            <td>${swing.bat_speed} mph</td>
                            <td>${swing.intercept_y}"</td>
                            <td>${swing.swing_path_tilt}°</td>
                            <td><strong class="text-primary">${swing.sword_score}</strong></td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                resultsContent.innerHTML = html;
            }
            
            results.style.display = 'block';
            
            // Show the Raw JSON button
            const rawJsonButtonContainer = document.getElementById('rawJsonButtonContainer');
            rawJsonButtonContainer.style.display = 'block';
        }
        
        function showError(message) {
            const errorAlert = document.getElementById('errorAlert');
            const errorMessage = document.getElementById('errorMessage');
            
            errorMessage.textContent = message;
            errorAlert.style.display = 'block';
        }
        
        // Store the latest API response for the modal
        let latestApiResponse = null;
        
        function updateExampleResponse(data) {
            latestApiResponse = data;
        }
        
        function showRawJsonModal() {
            if (latestApiResponse) {
                const jsonContent = document.getElementById('rawJsonContent');
                jsonContent.textContent = JSON.stringify(latestApiResponse, null, 2);
                
                const modal = new bootstrap.Modal(document.getElementById('rawJsonModal'));
                modal.show();
            }
        }
        
        function copyJsonToClipboard() {
            if (latestApiResponse) {
                const jsonString = JSON.stringify(latestApiResponse, null, 2);
                navigator.clipboard.writeText(jsonString).then(function() {
                    // Change button text temporarily to show success
                    const copyBtn = document.querySelector('#rawJsonModal .btn-outline-primary');
                    const originalText = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check me-1"></i>Copied!';
                    setTimeout(() => {
                        copyBtn.innerHTML = originalText;
                    }, 2000);
                });
            }
        }
        
        // Set default date to yesterday
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        document.getElementById('dateInput').value = yesterday.toISOString().split('T')[0];
    </script>
</body>
</html>
